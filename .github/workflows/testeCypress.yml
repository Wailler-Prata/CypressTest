name: Cypress Tests using Cypress Docker Image

on: push

jobs:
  cypress-run:
    runs-on: ubuntu-22.04
    container: cypress/browsers:node16.16.0-chrome107-ff107-edge
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Cypress run
        uses: cypress-io/github-action@v5
        
      - name: Run Reset teste reports
        run: npm run reset:reports
        
      - name: Run Cypress
        run: npm run cy:run
        
        continue-on-error: true
        
      - name: Merge test results into one
        run: npm run mergeReports:json
        
      - name: Generate HTML report
        run: npm run generateMochawesome-report:html

      - name: Deploy report page
        uses: peaceiris/actions-gh-pages@v3
        with:
           github_token: ${{ secrets.GITHUB_TOKEN }}
           publish_dir: ./reports/html
           user_name: 'github-actions[bot]'
           user_email: 'github-actions[bot]@users.noreply.github.com'
        
